<!DOCTYPE html>
<html lang="pt-BR"> <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Monitoramento de Minimercados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <style>
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            height: 300px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 350px;
            }
        }
        .details-content.hidden {
            display: none;
        }
        .toggle-details-btn svg {
            transition: transform 0.2s ease-in-out;
        }
        .toggle-details-btn.collapsed svg {
            transform: rotate(180deg);
        }
        .ocorrencia-item.editing .view-mode { display: none; }
        .ocorrencia-item:not(.editing) .edit-mode { display: none; }
    </style>
</head>
<body class="bg-slate-50 text-slate-800 dark:bg-slate-900 dark:text-slate-200 transition-colors duration-200">

    <div class="container mx-auto p-4 md:p-6 lg:p-8">
        
        <header class="mb-8 text-center relative">
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-slate-100">Painel de Monitoramento</h1>
            <p class="text-slate-600 mt-2 dark:text-slate-400">Controle de backups, análises e ocorrências de minimercados.</p>
            
            <div class="absolute top-0 right-0 p-4">
               <button id="theme-toggle" class="p-2 rounded-full bg-slate-200 dark:bg-slate-700 text-slate-800 dark:text-slate-200 transition-colors">
                   <svg id="theme-toggle-light-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.707.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-1.636 4.95l1.414.707a1 1 0 01-1.414 1.414l-1.414-.707a1 1 0 011.414-1.414zm-12.232-4.95a1 1 0 100 2H3a1 1 0 100-2h1.132zM4.95 16.364l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-1.414-1.414zM4.95 3.636l.707.707a1 1 0 01-1.414 1.414L3.536 4.343a1 1 0 011.414-1.414z"></path></svg>
                   <svg id="theme-toggle-dark-icon" class="w-5 h-5 hidden" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"></path></svg>
               </button>
            </div>
        </header>

        <section id="dashboard-resumo" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Solicitações Ativas</h3>
                <p id="total-solicitacoes" class="text-3xl font-bold text-orange-600 mt-1">0</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Backups Pendentes</h3>
                <p id="backups-pendentes" class="text-3xl font-bold text-amber-500 mt-1">0</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Análises Pendentes</h3>
                <p id="analises-pendentes" class="text-3xl font-bold text-red-500 mt-1">0</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Ocorrências (Semana)</h3>
                <p id="total-ocorrencias-semana" class="text-3xl font-bold text-slate-700 dark:text-slate-300 mt-1">0</p>
            </div>
        </section>

        <section id="weekly-productivity" class="mb-8">
             <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center max-w-sm mx-auto">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Produtividade Semanal (Ocorrências / Análise)</h3>
                <p id="produtividade-semanal" class="text-3xl font-bold text-emerald-600 mt-1">N/A</p>
                <p class="text-xs text-slate-400 dark:text-slate-500 mt-1">Média da semana atual</p>
            </div>
        </section>


        <section class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md mb-8">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex flex-wrap items-center gap-4 flex-grow">
                    <input type="text" id="filtro-condominio" placeholder="Filtrar por condomínio..." class="border border-slate-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 flex-grow md:flex-grow-0 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
                    <input type="date" id="filtro-data" class="border border-slate-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:calendar-picker-indicator:invert">
                    <input type="number" id="filtro-semana" placeholder="Semana de Trabalho (Ex: 43)" class="border border-slate-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 w-44 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
                    <select id="filtro-backup" class="border border-slate-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
                        <option value="">Status do Backup (Todos)</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Concluído">Concluído</option>
                        <option value="Não visualizar">Não visualizar</option>
                    </select>
                    <select id="filtro-analise" class="border border-slate-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
                        <option value="">Status da Análise (Todos)</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em Análise">Em Análise</option>
                        <option value="Concluída">Concluída</option>
                        <option value="Não visualizar">Não visualizar</option>
                    </select>
                    <div class="flex gap-2">
                        <button id="expand-all-btn" class="text-xs bg-slate-200 text-slate-700 px-2 py-1 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Expandir Todos</button>
                        <button id="collapse-all-btn" class="text-xs bg-slate-200 text-slate-700 px-2 py-1 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Recolher Todos</button>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                    <button id="priority-btn" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700 transition-colors w-full sm:w-auto flex-grow">
                        Prioridades
                    </button>
                    <button id="pdv-dashboard-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600 transition-colors w-full sm:w-auto flex-grow">
                        Painel do PDV
                    </button>
                    <button id="annual-report-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600 transition-colors w-full sm:w-auto flex-grow">
                        Análise Anual
                    </button>
                    <button id="period-analysis-btn" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700 transition-colors w-full sm:w-auto flex-grow">
                        Análise por Período
                    </button>
                    <button id="add-task-btn" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700 transition-colors w-full sm:w-auto flex-grow">
                        + Adicionar Análise
                    </button>
                </div>
            </div>
             <div class="flex flex-wrap gap-2 w-full sm:w-auto mt-4 justify-end">
                <div class="relative inline-block text-left" id="actions-menu-container">
                    <div>
                        <button type="button" id="actions-menu-btn" class="inline-flex justify-center w-full rounded-md border border-slate-300 shadow-sm px-4 py-2 bg-white text-sm font-medium text-slate-700 hover:bg-slate-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-100 focus:ring-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:hover:bg-slate-600" aria-haspopup="true" aria-expanded="true">
                            Ações
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>

                    <div id="actions-menu" class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white ring-1 ring-black ring-opacity-5 hidden z-20 dark:bg-slate-800 dark:ring-white dark:ring-opacity-10">
                        <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="actions-menu-btn">
                            <button id="planner-btn" class="w-full text-left font-semibold text-orange-700 dark:text-orange-500 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Planejar Semana</A-button>
                            <button id="bulk-add-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Importar da Planilha</button>
                            <button id="rename-condo-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Renomear Condomínio</button>
                            <button id="category-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Gerenciar Categorias</button>
                            <button id="archive-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Arquivar Análises</button>
                            <div class="border-t border-slate-100 dark:border-slate-700 my-1"></div>
                            <button id="restore-btn" class="w-full text-left text-orange-700 dark:text-orange-500 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Restaurar Backup</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <main id="task-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
            </main>
        
        <section class="mt-12">
            <h2 class="text-2xl font-bold text-center mb-8 text-slate-800 dark:text-slate-100">Ocorrências da Semana (por Condomínio)</h2>
            <div class="flex justify-center">
                <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md w-full lg:w-1/2">
                     <h3 class="text-center font-semibold mb-4 dark:text-slate-300">Ocorrências por Condomínio (Semana Atual)</h3>
                     <div class="chart-container">
                         <canvas id="ocorrenciasChart"></canvas>
                     </div>
                </div>
            </div>
        </section>
    </div>
    
    <input type="file" id="restore-input" class="hidden" accept=".json">
    <div id="priority-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-slate-100">Por Onde Começar? (Prioridades)</h2>
                <button id="priority-close-btn" class="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            <p class="text-slate-600 dark:text-slate-400 mb-6">Esta é uma lista sugerida de suas análises, priorizando condomínios com maior histórico de ocorrências e as datas mais antigas.</p>
            <div class="flex-grow overflow-y-auto">
                <ul id="priority-task-list" class="space-y-3">
                    </ul>
            </div>
        </div>
    </div>
    
    <div id="planner-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4 dark:text-slate-100">Planejador Semanal Inteligente</h2>
            <form id="planner-form">
                <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">O sistema analisou seu histórico e sugere focar nestes condomínios de maior risco. Selecione quais deseja adicionar ao seu planejamento.</p>
                 <div class="mb-4">
                    <label for="planner-week-number" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Planejar para a Semana de Trabalho (Nº):</label>
                    <input type="number" id="planner-week-number" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200" required>
                </div>
                <div id="planner-list-container" class="flex-grow overflow-y-auto bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md min-h-[200px] max-h-64 space-y-2">
                    </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="planner-cancel-btn" class="bg-slate-200 text-slate-800 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Cancelar</button>
                    <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Gerar Tarefas</button>
                </div>
            </form>
        </div>
    </div>


    <div id="pdv-dashboard-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-slate-100">Painel do PDV</h2>
                <button id="pdv-dashboard-close-btn" class="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            <div class="mb-4">
                <label for="pdv-select" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Selecione o Condomínio</label>
                <select id="pdv-select" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200"></select>
            </div>
            <div id="pdv-content" class="flex-grow overflow-y-auto hidden space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total Análises (Histórico)</h3>
                        <p id="pdv-total-analises" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total Ocorrências (Histórico)</h3>
                        <p id="pdv-total-ocorrencias" class="text-3xl font-bold text-red-600 mt-1">0</p>
                    </div>
                </section>
                <section class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                    <h3 class="text-center font-semibold mb-4 dark:text-slate-300">Tendência de Ocorrências (Últimos 12 Meses)</h3>
                    <div class="chart-container" style="height: 250px; max-height: 250px;">
                        <canvas id="pdvTrendChart"></canvas>
                    </div>
                </section>
                <section>
                    <h3 class="font-semibold mb-2 text-lg dark:text-slate-200">Histórico de Análises</h3>
                    <ul id="pdv-task-list" class="space-y-2 max-h-60 overflow-y-auto pr-2"></ul>
                </section>
            </div>
        </div>
    </div>
    
    <div id="archive-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4 dark:text-slate-100">Arquivar Análises Concluídas</h2>
            <form id="archive-form">
                <p class="text-slate-600 dark:text-slate-400 mb-4">Selecione o período para arquivar análises concluídas. Isso irá removê-las da tela principal, mas elas não serão excluídas.</p>
                <div class="space-y-2 mb-6">
                    <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-orange-50 has-[:checked]:border-orange-300 dark:border-slate-700 dark:has-[:checked]:bg-orange-900/50 dark:has-[:checked]:border-orange-700">
                        <input type="radio" name="archive_period" value="7" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500">
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Mais antigas que 1 semana</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-orange-50 has-[:checked]:border-orange-300 dark:border-slate-700 dark:has-[:checked]:bg-orange-900/50 dark:has-[:checked]:border-orange-700">
                        <input type="radio" name="archive_period" value="30" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500" checked>
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Mais antigas que 1 mês</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-orange-50 has-[:checked]:border-orange-300 dark:border-slate-700 dark:has-[:checked]:bg-orange-900/50 dark:has-[:checked]:border-orange-700">
                        <input type="radio" name="archive_period" value="90" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500">
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Mais antigas que 3 meses</span>
                    </label>
                </div>
                <div class="flex justify-between items-center gap-3">
                    <button type="button" id="view-archive-btn" class="bg-slate-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-slate-600">Ver Arquivadas</button>
                    <div class="flex gap-3">
                        <button type="button" id="archive-cancel-btn" class="bg-slate-200 text-slate-800 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Cancelar</button>
                        <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Arquivar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <div id="view-archive-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-20">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-slate-100">Análises Arquivadas</h2>
                <button id="view-archive-close-btn" class="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
             <div class="mb-4">
                <input type="text" id="archive-search-input" placeholder="Buscar em arquivadas por condomínio..." class="w-full border border-slate-300 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
            </div>
            <div id="view-archive-list-container" class="flex-grow overflow-y-auto bg-slate-50 dark:bg-slate-700/50 p-3 rounded-md min-h-[200px]">
                <p class="text-center text-slate-500 dark:text-slate-400">Nenhuma análise arquivada.</p>
            </div>
            <div class="mt-4 text-right">
                 <button id="unarchive-selected-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Desarquivar Selecionadas</button>
            </div>
        </div>
    </div>


    <div id="period-analysis-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-slate-100">Análise por Período</h2>
                <button id="period-analysis-close-btn" class="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 border-b dark:border-slate-700 pb-4 mb-4">
                <div>
                    <label for="period-start-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Data de Início</label>
                    <input type="date" id="period-start-date" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:calendar-picker-indicator:invert">
                </div>
                <div>
                    <label for="period-end-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Data de Fim</label>
                    <input type="date" id="period-end-date" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:calendar-picker-indicator:invert">
                </div>
                <div class="flex items-end">
                    <button id="generate-report-btn" class="bg-orange-600 text-white font-semibold w-full px-4 py-2 rounded-md hover:bg-orange-700">Gerar Relatório</button>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Analisar por:</label>
                <div class="flex gap-4">
                    <label class="flex items-center">
                        <input type="radio" name="analysis_type" value="dataAnalise" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500">
                        <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Data da Análise</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="analysis_type" value="dataConclusao" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500">
                        <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Data da Conclusão</span>
                    </label>
                </div>
            </div>

            <div class="flex flex-wrap gap-2 mb-4">
                <button data-period="this-week" class="period-btn text-xs bg-slate-200 text-slate-700 px-3 py-1 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Esta Semana</button>
                <button data-period="last-week" class="period-btn text-xs bg-slate-200 text-slate-700 px-3 py-1 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Semana Passada</button>
                <button data-period="this-month" class="period-btn text-xs bg-slate-200 text-slate-700 px-3 py-1 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Este Mês</button>
                <button data-period="last-month" class="period-btn text-xs bg-slate-200 text-slate-700 px-3 py-1 rounded-md hover:bg-slate-300 dark:bg-slate-700 dark:text-slate-200 dark:hover:bg-slate-600">Mês Passado</button>
            </div>

            <div id="period-results-content" class="flex-grow overflow-y-auto hidden">
                <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Dias (Análises)</h3>
                        <p id="period-dias" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">PDV (Condomínios)</h3>
                        <p id="period-pdv" class="text-3xl font-bold text-orange-500 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">OC (Ocorrências)</h3>
                        <p id="period-oc" class="text-3xl font-bold text-red-600 mt-1">0</p>
                    </div>
                </section>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                        <h3 class="text-center font-semibold mb-4 dark:text-slate-300">Ocorrências por Categoria</h3>
                        <div class="chart-container" style="height: 250px; max-height: 250px;">
                            <canvas id="periodCategoryChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-center font-semibold dark:text-slate-300">Ocorrências por Condomínio (no Período)</h3>
                            <select id="period-category-filter" class="border border-slate-300 rounded-md px-2 py-1 text-xs focus:ring-2 focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
                                <option value="">Filtrar Categoria</option>
                            </select>
                        </div>
                        <div class="chart-container" style="height: 250px; max-height: 250px;">
                            <canvas id="periodChart"></canvas>
                        </div>
                    </div>
                </div>
                 <div class="mt-6">
                    <h3 class="font-semibold mb-2 text-lg dark:text-slate-200">Lista de Análises no Período</h3>
                    <ul id="period-task-list" class="space-y-2 max-h-40 overflow-y-auto pr-2 bg-slate-50 dark:bg-slate-700/50 p-2 rounded-md"></ul>
                </div>
            </div>
        </div>
    </div>
    
    <div id="annual-report-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-6xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold dark:text-slate-100" id="annual-report-title">Análise Anual (2025)</h2>
                <button id="annual-report-close-btn" class="text-slate-500 hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            <div class="flex-grow overflow-y-auto space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total de Análises Concluídas (Ano)</h3>
                        <p id="annual-total-analises" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total de Ocorrências (Ano)</h3>
                        <p id="annual-total-ocorrencias" class="text-3xl font-bold text-red-600 mt-1">0</p>
                    </div>
                </section>
                <section class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                    <h3 class="text-center font-semibold mb-4 dark:text-slate-300">Ocorrências por Mês</h3>
                    <div class="chart-container" style="height: 250px; max-height: 250px;">
                        <canvas id="annualReportChart_Monthly"></canvas>
                    </div>
                </section>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                        <h3 class="text-center font-semibold mb-4 dark:text-slate-300">Ocorrências por Categoria (Ano)</h3>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="annualReportChart_Category"></canvas>
                        </div>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-700/50 p-4 rounded-lg">
                        <h3 class="text-center font-semibold mb-4 dark:text-slate-300">Top 10 Condomínios (Ocorrências no Ano)</h3>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="annualReportChart_Condo"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4 dark:text-slate-100">Adicionar Nova Análise</h2>
            <form id="task-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="form-condominio" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Condomínio</label>
                        <div class="relative">
                            <input type="text" id="form-condominio" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200" required autocomplete="off">
                            <div id="autocomplete-list" class="absolute z-10 w-full bg-white border border-slate-300 rounded-md mt-1 hidden max-h-40 overflow-y-auto shadow-lg dark:bg-slate-800 dark:border-slate-600"></div>
                        </div>
                    </div>
                    <div>
                        <label for="form-data-analise" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Data para Análise</label>
                        <input type="date" id="form-data-analise" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200 dark:calendar-picker-indicator:invert" required>
                    </div>
                </div>
                 <div class="mt-4">
                    <label for="form-semana-trabalho" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Semana de Trabalho (Nº)</label>
                    <input type="number" id="form-semana-trabalho" placeholder="Ex: 44" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-200">
                </div>
                 <div class="mt-4">
                    <label for="form-observacoes" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Observações</label>
                    <textarea id="form-observacoes" rows="3" class="mt-1 block w-full border border-slate-300 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 focus:border-orange-500 dark:bg-slate-700 dark:border-slate-600 dark:text-slate-20
