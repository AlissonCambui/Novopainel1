<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Monitoramento de Minimercados</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-slate-50 dark:bg-slate-900 text-slate-800 dark:text-slate-200">

    <div class="container mx-auto p-4 md:p-6 lg:p-8">
        
        <header class="mb-8 text-center">
            <div class="text-4xl font-extrabold mb-2 tracking-tight" style="font-family: 'Arial Black', Arial, sans-serif;">
                <span style="color: #f26324;">vend</span><span style="color: #f7b41e;">Perto</span>
            </div>
            <h1 class="text-3xl md:text-4xl font-bold text-slate-900 dark:text-slate-100">Painel de Monitoramento</h1>
            <p class="text-slate-600 dark:text-slate-400 mt-2">Controle de backups, análises e ocorrências de minimercados.</p>
        </header>

        <section id="dashboard-resumo" class="grid grid-cols-2 md:grid-cols-4 gap-4 md:gap-6 mb-8">
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Solicitações Ativas</h3>
                <p id="total-solicitacoes" class="text-3xl font-bold text-orange-600 mt-1">0</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Backups Pendentes</h3>
                <p id="backups-pendentes" class="text-3xl font-bold text-amber-500 mt-1">0</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Análises Pendentes</h3>
                <p id="analises-pendentes" class="text-3xl font-bold text-red-500 mt-1">0</p>
            </div>
            <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Ocorrências (Semana)</h3>
                <p id="total-ocorrencias-semana" class="text-3xl font-bold text-slate-700 dark:text-slate-300 mt-1">0</p>
            </div>
        </section>

        <section id="weekly-productivity" class="mb-8">
             <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md text-center max-w-sm mx-auto">
                <h3 class="text-sm font-semibold text-slate-500 dark:text-slate-400">Produtividade Semanal (Ocorrências / Análise)</h3>
                <p id="produtividade-semanal" class="text-3xl font-bold text-emerald-600 mt-1">N/A</p>
                <p class="text-xs text-slate-400 mt-1">Média da semana atual</p>
            </div>
        </section>


        <section class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md mb-8">
            <div class="flex flex-wrap items-center justify-between gap-4">
                <div class="flex flex-wrap items-center gap-4 flex-grow">
                    <input type="text" id="filtro-condominio" placeholder="Filtrar por condomínio..." class="border border-slate-300 dark:border-slate-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400 flex-grow md:flex-grow-0">
                    <input type="date" id="filtro-data" class="border border-slate-300 dark:border-slate-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                    <input type="number" id="filtro-semana" placeholder="Semana de Trabalho (Ex: 43)" class="border border-slate-300 dark:border-slate-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400 w-44">
                    <select id="filtro-backup" class="border border-slate-300 dark:border-slate-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                        <option value="">Status do Backup (Todos)</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em Andamento">Em Andamento</option>
                        <option value="Concluído">Concluído</option>
                        <option value="Não visualizar">Não visualizar</option>
                    </select>
                    <select id="filtro-analise" class="border border-slate-300 dark:border-slate-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                        <option value="">Status da Análise (Todos)</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Em Análise">Em Análise</option>
                        <option value="Concluída">Concluída</option>
                        <option value="Não visualizar">Não visualizar</option>
                    </select>
                    <div class="flex gap-2">
                        <button id="expand-all-btn" class="text-xs bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-2 py-1 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Expandir Todos</button>
                        <button id="collapse-all-btn" class="text-xs bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-2 py-1 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Recolher Todos</button>
                    </div>
                </div>
                <div class="flex flex-wrap gap-2 w-full sm:w-auto">
                    <button id="priority-btn" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700 transition-colors w-full sm:w-auto flex-grow">
                        Prioridades
                    </button>
                    <button id="pdv-dashboard-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600 transition-colors w-full sm:w-auto flex-grow">
                        Painel do PDV
                    </button>
                    <button id="annual-report-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600 transition-colors w-full sm:w-auto flex-grow">
                        Análise Anual
                    </button>
                    <button id="period-analysis-btn" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700 transition-colors w-full sm:w-auto flex-grow">
                        Análise por Período
                    </button>
                    <button id="add-task-btn" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700 transition-colors w-full sm:w-auto flex-grow">
                        + Adicionar Análise
                    </button>
                </div>
            </div>
             <div class="flex flex-wrap gap-2 w-full sm:w-auto mt-4 justify-end">
                <div class="relative inline-block text-left" id="actions-menu-container">
                    <div>
                        <button type="button" id="actions-menu-btn" class="inline-flex justify-center w-full rounded-md border border-slate-300 dark:border-slate-600 shadow-sm px-4 py-2 bg-white dark:bg-slate-800 text-sm font-medium text-slate-700 dark:text-slate-300 hover:bg-slate-50 dark:hover:bg-slate-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-offset-slate-100 focus:ring-orange-500 dark:focus:ring-orange-400" aria-haspopup="true" aria-expanded="true">
                            Ações
                            <svg class="-mr-1 ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true">
                                <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd" />
                            </svg>
                        </button>
                    </div>
        
                    <div id="actions-menu" class="origin-top-right absolute right-0 mt-2 w-56 rounded-md shadow-lg bg-white dark:bg-slate-800 ring-1 ring-black dark:ring-white ring-opacity-5 hidden z-20">
                        <div class="py-1" role="menu" aria-orientation="vertical" aria-labelledby="actions-menu-btn">
                            <button id="planner-btn" class="w-full text-left font-semibold text-orange-700 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Planejar Semana</A-button>
                            <button id="bulk-add-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Importar da Planilha</button>
                            <button id="rename-condo-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Renomear Condomínio</button>
                            <button id="category-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Gerenciar Categorias</button>
                            <button id="archive-btn" class="w-full text-left text-slate-700 dark:text-slate-300 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Arquivar Análises</button>
                            <div class="border-t border-slate-100 my-1"></div>
                            <button id="restore-btn" class="w-full text-left text-orange-700 block px-4 py-2 text-sm hover:bg-slate-100 dark:hover:bg-slate-700" role="menuitem">Restaurar Backup</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <main id="task-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-8">
        </main>
        
        <section class="mt-12">
            <h2 class="text-2xl font-bold text-center mb-8 text-slate-800 dark:text-slate-200">Ocorrências da Semana (por Condomínio)</h2>
            <div class="flex justify-center">
                <div class="bg-white dark:bg-slate-800 p-4 rounded-lg shadow-md w-full lg:w-1/2">
                     <h3 class="text-center font-semibold mb-4">Ocorrências por Condomínio (Semana Atual)</h3>
                     <div class="chart-container">
                        <canvas id="ocorrenciasChart"></canvas>
                     </div>
                </div>
            </div>
        </section>
    </div>
    
    <input type="file" id="restore-input" class="hidden" accept=".json">

    <div id="priority-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Por Onde Começar? (Prioridades)</h2>
                <button id="priority-close-btn" class="text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            <p class="text-slate-600 dark:text-slate-400 mb-6">Esta é uma lista sugerida de suas análises, priorizando condomínios com maior histórico de ocorrências e as datas mais antigas.</p>
            <div class="flex-grow overflow-y-auto">
                <ul id="priority-task-list" class="space-y-3">
                </ul>
            </div>
        </div>
    </div>
    
    <div id="planner-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4">Planejador Semanal Inteligente</h2>
            <form id="planner-form">
                <p class="text-sm text-slate-600 dark:text-slate-400 mb-4">O sistema analisou seu histórico e sugere focar nestes condomínios de maior risco. Selecione quais deseja adicionar ao seu planejamento.</p>
                 <div class="mb-4">
                    <label for="planner-week-number" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Planejar para a Semana de Trabalho (Nº):</label>
                    <input type="number" id="planner-week-number" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400" required>
                 </div>
                <div id="planner-list-container" class="flex-grow overflow-y-auto bg-slate-50 dark:bg-slate-900 p-3 rounded-md min-h-[200px] max-h-64 space-y-2">
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="planner-cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                    <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Gerar Tarefas</button>
                </div>
            </form>
        </div>
    </div>


    <div id="pdv-dashboard-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Painel do PDV</h2>
                <button id="pdv-dashboard-close-btn" class="text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            <div class="mb-4">
                <label for="pdv-select" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Selecione o Condomínio</label>
                <select id="pdv-select" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400"></select>
            </div>
            <div id="pdv-content" class="flex-grow overflow-y-auto hidden space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total Análises (Histórico)</h3>
                        <p id="pdv-total-analises" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total Ocorrências (Histórico)</h3>
                        <p id="pdv-total-ocorrencias" class="text-3xl font-bold text-red-600 mt-1">0</p>
                    </div>
                </section>
                <section class="bg-slate-50 dark:bg-slate-900 p-4 rounded-lg">
                    <h3 class="text-center font-semibold mb-4">Tendência de Ocorrências (Últimos 12 Meses)</h3>
                    <div class="chart-container" style="height: 250px; max-height: 250px;">
                        <canvas id="pdvTrendChart"></canvas>
                    </div>
                </section>
                <section>
                    <h3 class="font-semibold mb-2 text-lg">Histórico de Análises</h3>
                    <ul id="pdv-task-list" class="space-y-2 max-h-60 overflow-y-auto pr-2"></ul>
                </section>
            </div>
        </div>
    </div>
    
    <div id="archive-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4">Arquivar Análises Concluídas</h2>
            <form id="archive-form">
                <p class="text-slate-600 dark:text-slate-400 mb-4">Selecione o período para arquivar análises concluídas. Isso irá removê-las da tela principal, mas elas não serão excluídas.</p>
                <div class="space-y-2 mb-6">
                    <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-orange-50 dark:has-[:checked]:bg-orange-900/50 has-[:checked]:border-orange-300 dark:has-[:checked]:border-orange-600">
                        <input type="radio" name="archive_period" value="7" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 dark:focus:ring-orange-400">
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Mais antigas que 1 semana</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-orange-50 dark:has-[:checked]:bg-orange-900/50 has-[:checked]:border-orange-300 dark:has-[:checked]:border-orange-600">
                        <input type="radio" name="archive_period" value="30" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 dark:focus:ring-orange-400" checked>
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Mais antigas que 1 mês</span>
                    </label>
                    <label class="flex items-center p-3 border rounded-md has-[:checked]:bg-orange-50 dark:has-[:checked]:bg-orange-900/50 has-[:checked]:border-orange-300 dark:has-[:checked]:border-orange-600">
                        <input type="radio" name="archive_period" value="90" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 dark:focus:ring-orange-400">
                        <span class="ml-3 text-sm font-medium text-slate-700 dark:text-slate-300">Mais antigas que 3 meses</span>
                    </label>
                </div>
                <div class="flex justify-between items-center gap-3">
                    <button type="button" id="view-archive-btn" class="bg-slate-500 dark:text-slate-400 text-white font-semibold px-4 py-2 rounded-md hover:bg-slate-600">Ver Arquivadas</button>
                    <div class="flex gap-3">
                        <button type="button" id="archive-cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                        <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Arquivar</button>
                    </div>
                </div>
            </form>
        </div>
    </div>
    
    <div id="view-archive-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-20">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-3xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Análises Arquivadas</h2>
                <button id="view-archive-close-btn" class="text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
             <div class="mb-4">
                <input type="text" id="archive-search-input" placeholder="Buscar em arquivadas por condomínio..." class="w-full border border-slate-300 dark:border-slate-600 rounded-md px-3 py-2 text-sm focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
             </div>
            <div id="view-archive-list-container" class="flex-grow overflow-y-auto bg-slate-50 dark:bg-slate-900 p-3 rounded-md min-h-[200px]">
                <p class="text-center text-slate-500 dark:text-slate-400">Nenhuma análise arquivada.</p>
            </div>
            <div class="mt-4 text-right">
                 <button id="unarchive-selected-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600 disabled:opacity-50 disabled:cursor-not-allowed" disabled>Desarquivar Selecionadas</button>
            </div>
        </div>
    </div>


    <div id="period-analysis-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-4xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold">Análise por Período</h2>
                <button id="period-analysis-close-btn" class="text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 border-b pb-4 mb-4">
                <div>
                    <label for="period-start-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Data de Início</label>
                    <input type="date" id="period-start-date" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                </div>
                <div>
                    <label for="period-end-date" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Data de Fim</label>
                    <input type="date" id="period-end-date" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                </div>
                <div class="flex items-end">
                    <button id="generate-report-btn" class="bg-orange-600 text-white font-semibold w-full px-4 py-2 rounded-md hover:bg-orange-700">Gerar Relatório</button>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium text-slate-700 dark:text-slate-300 mb-2">Analisar por:</label>
                <div class="flex gap-4">
                    <label class="flex items-center">
                        <input type="radio" name="analysis_type" value="dataAnalise" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 dark:focus:ring-orange-400" checked>
                        <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Data da Análise</span>
                    </label>
                    <label class="flex items-center">
                        <input type="radio" name="analysis_type" value="dataConclusao" class="h-4 w-4 text-orange-600 border-gray-300 focus:ring-orange-500 dark:focus:ring-orange-400">
                        <span class="ml-2 text-sm text-slate-700 dark:text-slate-300">Data da Conclusão</span>
                    </label>
                </div>
            </div>

            <div class="flex flex-wrap gap-2 mb-4">
                <button data-period="this-week" class="period-btn text-xs bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-3 py-1 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Esta Semana</button>
                <button data-period="last-week" class="period-btn text-xs bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-3 py-1 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Semana Passada</button>
                <button data-period="this-month" class="period-btn text-xs bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-3 py-1 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Este Mês</button>
                <button data-period="last-month" class="period-btn text-xs bg-slate-200 dark:bg-slate-600 text-slate-700 dark:text-slate-300 px-3 py-1 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Mês Passado</button>
            </div>

            <div id="period-results-content" class="flex-grow overflow-y-auto hidden">
                <section class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Dias (Análises)</h3>
                        <p id="period-dias" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">PDV (Condomínios)</h3>
                        <p id="period-pdv" class="text-3xl font-bold text-orange-500 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">OC (Ocorrências)</h3>
                        <p id="period-oc" class="text-3xl font-bold text-red-600 mt-1">0</p>
                    </div>
                </section>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-slate-50 dark:bg-slate-900 p-4 rounded-lg">
                        <h3 class="text-center font-semibold mb-4">Ocorrências por Categoria</h3>
                        <div class="chart-container" style="height: 250px; max-height: 250px;">
                            <canvas id="periodCategoryChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-900 p-4 rounded-lg">
                        <div class="flex justify-between items-center mb-4">
                            <h3 class="text-center font-semibold">Ocorrências por Condomínio (no Período)</h3>
                            <select id="period-category-filter" class="border border-slate-300 dark:border-slate-600 rounded-md px-2 py-1 text-xs focus:ring-2 focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                                <option value="">Filtrar Categoria</option>
                            </select>
                        </div>
                        <div class="chart-container" style="height: 250px; max-height: 250px;">
                            <canvas id="periodChart"></canvas>
                        </div>
                    </div>
                </div>
                 <div class="mt-6">
                    <h3 class="font-semibold mb-2 text-lg">Lista de Análises no Período</h3>
                    <ul id="period-task-list" class="space-y-2 max-h-40 overflow-y-auto pr-2 bg-slate-50 dark:bg-slate-900 p-2 rounded-md"></ul>
                 </div>
            </div>
        </div>
    </div>
    
    <div id="annual-report-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-6xl max-h-[90vh] flex flex-col">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-2xl font-bold" id="annual-report-title">Análise Anual (2025)</h2>
                <button id="annual-report-close-btn" class="text-slate-500 dark:text-slate-400 hover:text-slate-800 dark:hover:text-slate-200 text-2xl font-bold">&times;</button>
            </div>
            <div class="flex-grow overflow-y-auto space-y-6">
                <section class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total de Análises Concluídas (Ano)</h3>
                        <p id="annual-total-analises" class="text-3xl font-bold text-orange-600 mt-1">0</p>
                    </div>
                    <div class="bg-slate-100 dark:bg-slate-700 p-4 rounded-lg text-center">
                        <h3 class="text-lg font-semibold text-slate-500 dark:text-slate-400">Total de Ocorrências (Ano)</h3>
                        <p id="annual-total-ocorrencias" class="text-3xl font-bold text-red-600 mt-1">0</p>
                    </div>
                </section>
                <section class="bg-slate-50 dark:bg-slate-900 p-4 rounded-lg">
                    <h3 class="text-center font-semibold mb-4">Ocorrências por Mês</h3>
                    <div class="chart-container" style="height: 250px; max-height: 250px;">
                        <canvas id="annualReportChart_Monthly"></canvas>
                    </div>
                </section>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-slate-50 dark:bg-slate-900 p-4 rounded-lg">
                        <h3 class="text-center font-semibold mb-4">Ocorrências por Categoria (Ano)</h3>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="annualReportChart_Category"></canvas>
                        </div>
                    </div>
                    <div class="bg-slate-50 dark:bg-slate-900 p-4 rounded-lg">
                        <h3 class="text-center font-semibold mb-4">Top 10 Condomínios (Ocorrências no Ano)</h3>
                        <div class="chart-container" style="height: 300px; max-height: 300px;">
                            <canvas id="annualReportChart_Condo"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="task-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4">Adicionar Nova Análise</h2>
            <form id="task-form">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label for="form-condominio" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Condomínio</label>
                        <div class="relative">
                            <input type="text" id="form-condominio" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400" required autocomplete="off">
                            <div id="autocomplete-list" class="absolute z-10 w-full bg-white dark:bg-slate-800 border border-slate-300 dark:border-slate-600 rounded-md mt-1 hidden max-h-40 overflow-y-auto shadow-lg"></div>
                        </div>
                    </div>
                    <div>
                        <label for="form-data-analise" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Data para Análise</label>
                        <input type="date" id="form-data-analise" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400" required>
                    </div>
                </div>
                 <div class="mt-4">
                    <label for="form-semana-trabalho" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Semana de Trabalho (Nº)</label>
                    <input type="number" id="form-semana-trabalho" placeholder="Ex: 44" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                 </div>
                 <div class="mt-4">
                    <label for="form-observacoes" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Observações</label>
                    <textarea id="form-observacoes" rows="3" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400"></textarea>
                 </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                    <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Salvar</button>

                </div>
            </form>
        </div>
    </div>
    
    <div id="bulk-add-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4">Importar Análises da Planilha</h2>
            <form id="bulk-add-form">
                <div class="text-sm text-slate-600 dark:text-slate-400 space-y-3 mb-6">
                     <p>Copie os dados da sua planilha (incluindo a linha de cabeçalho) e cole no campo abaixo.</p>
                     <ol class="list-decimal list-inside space-y-2 pl-4">
                         <li>Garanta que sua planilha tenha as colunas: `Semana`, `Dia a visualizar`, `Unidade`, `Status` e `OC`.</li>
                         <li>Copie os dados (Ctrl+C), incluindo a linha de cabeçalho.</li>
                         <li>Cole os dados (Ctrl+V) na área de texto e clique em "Importar".</li>
                     </ol>
                     <p class="text-xs text-slate-500 dark:text-slate-400 mt-2"><strong>Obs:</strong> Tarefas `Finalizado` com `OC > 0` serão arquivadas. Tarefas `Pendente` serão adicionadas ao painel. Duplicatas serão ignoradas.</p>
                </div>
                <div>
                    <label for="bulk-input-area" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Cole os dados da planilha aqui (com cabeçalho):</label>
                    <textarea id="bulk-input-area" rows="10" class="mt-1 w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm p-2 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400"></textarea>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="bulk-cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                    <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Importar</button>
                </div>
            </form>
        </div>
    </div>

    <div id="ocorrencia-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-2xl max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4">Registrar Detalhes da Ocorrência</h2>
            <form id="ocorrencia-form" class="flex-grow flex flex-col min-h-0">
                <input type="hidden" id="ocorrencia-task-id">
                <div id="ocorrencia-list" class="flex-grow overflow-y-auto pr-2 -mr-2 mb-4 space-y-3"></div>
                <div class="flex-shrink-0 pt-4 border-t">
                    <h3 class="font-semibold mb-2">Adicionar Nova Ocorrência</h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                         <div>
                            <label for="add-ocorrencia-categoria" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Categoria</label>
                            <select id="add-ocorrencia-categoria" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400"></select>
                         </div>
                        <div class="md:col-span-1">
                           <label for="add-ocorrencia-desc" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Descrição</label>
                           <textarea id="add-ocorrencia-desc" rows="2" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400"></textarea>
                        </div>
                        <div>
                            <label for="add-horario-inicial" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Horário Inicial</label>
                            <input type="time" id="add-horario-inicial" step="1" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                        </div>
                        <div>
                            <label for="add-horario-final" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Horário Final</label>
                            <input type="time" id="add-horario-final" step="1" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400">
                        </div>
                    </div>
                     <div class="mt-3">
                        <label class="flex items-center">
                            <input type="checkbox" id="add-ocorrencia-inconclusiva" class="h-4 w-4 text-orange-600 border-gray-300 rounded focus:ring-orange-500 dark:focus:ring-orange-400">
                            <span class="ml-2 text-sm font-medium text-slate-700 dark:text-slate-300">Marcar como Inconclusiva</span>
                        </label>
                    </div>
                     <button type="button" id="add-ocorrencia-btn" class="mt-3 w-full bg-orange-100 text-orange-800 font-semibold px-4 py-2 rounded-md hover:bg-orange-200">+ Adicionar à Lista</button>
                </div>
                <div class="mt-6 flex justify-end gap-3 flex-shrink-0">
                    <button type="button" id="ocorrencia-cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                    <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Salvar Ocorrências</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="category-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-20">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-md max-h-[90vh] flex flex-col">
            <h2 class="text-2xl font-bold mb-4">Gerenciar Categorias</h2>
            <form id="add-category-form" class="flex gap-2 mb-4">
                <input type="text" id="new-category-name" placeholder="Nova categoria..." class="flex-grow border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400" required>
                <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Adicionar</button>
            </form>
            <div id="category-list-container" class="flex-grow overflow-y-auto bg-slate-50 dark:bg-slate-900 p-3 rounded-md min-h-[150px]">
            </div>
             <div class="mt-6 text-right">
                <button type="button" id="category-close-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Fechar</button>
             </div>
        </div>
    </div>


    <div id="rename-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-10">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4">Renomear Condomínio</h2>
            <form id="rename-form">
                <div class="space-y-4">
                    <div>
                        <label for="form-old-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Nome Antigo do Condomínio</label>
                        <select id="form-old-name" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400" required></select>
                    </div>
                    <div>
                        <label for="form-new-name" class="block text-sm font-medium text-slate-700 dark:text-slate-300">Novo Nome do Condomínio</label>
                        <input type="text" id="form-new-name" class="mt-1 block w-full border border-slate-300 dark:border-slate-600 rounded-md shadow-sm py-2 px-3 focus:outline-none focus:ring-orange-500 dark:focus:ring-orange-400 focus:border-orange-500 dark:focus:border-orange-400" required>
                    </div>
                </div>
                <div class="mt-6 flex justify-end gap-3">
                    <button type="button" id="rename-cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                    <button type="submit" class="bg-orange-600 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-700">Salvar Alteração</button>
                </div>
            </form>
        </div>
    </div>
    
    <div id="restore-confirm-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-30">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-lg">
            <h2 class="text-2xl font-bold mb-4 text-orange-600">Atenção!</h2>
            <p class="text-slate-600 dark:text-slate-400">Restaurar um backup irá <strong>substituir todos os dados atuais</strong>. Esta ação não pode ser desfeita. Deseja continuar?</p>
            <div class="mt-6 flex justify-end gap-3">
                <button type="button" id="restore-confirm-cancel-btn" class="bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 font-semibold px-4 py-2 rounded-md hover:bg-slate-300 dark:hover:bg-slate-500">Cancelar</button>
                <button type="button" id="restore-confirm-proceed-btn" class="bg-orange-500 text-white font-semibold px-4 py-2 rounded-md hover:bg-orange-600">Sim, Restaurar</button>
            </div>
        </div>
    </div>

    <div id="notification-modal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-40">
        <div class="bg-white dark:bg-slate-800 rounded-lg shadow-2xl p-6 w-full max-w-sm text-center">
            <p id="notification-message" class="text-slate-700 dark:text-slate-300 text-lg"></p>
            <button id="notification-close-btn" class="mt-6 bg-orange-600 text-white font-semibold px-6 py-2 rounded-md hover:bg-orange-700">OK</button>
        </div>
    </div>

    <script src="script.js"></script>
</body>
</html>